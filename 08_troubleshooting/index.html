<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://M-Polonczyk.github.io/crypto-bi/08_troubleshooting/">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Troubleshooting - Crypto BI</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Crypto BI</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item">
                                <a href="../01_architecture/" class="nav-link">System Architecture</a>
                            </li>
                            <li class="nav-item">
                                <a href="../02_data_sources/" class="nav-link">Data Sources</a>
                            </li>
                            <li class="nav-item">
                                <a href="../03_ingestion_pipeline/" class="nav-link">Ingestion Pipeline</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">dbt Data Modeling</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href=".." class="dropdown-item">Home</a>
</li>
                                    
<li>
    <a href="../04_dbt_data_modeling/04_01_dimensional_model/" class="dropdown-item">Dimensional Model</a>
</li>
                                    
<li>
    <a href="../04_dbt_data_modeling/04_02_sources/" class="dropdown-item">Sources</a>
</li>
                                    
<li>
    <a href="../04_dbt_data_modeling/04_03_staging_layer.md" class="dropdown-item">Staging Layer</a>
</li>
                                    
<li>
    <a href="../04_dbt_data_modeling/04_04_marts_layer/" class="dropdown-item">Marts Layer</a>
</li>
                                    
<li>
    <a href="../04_dbt_data_modeling/04_05_testing_and_quality.md" class="dropdown-item">Testing and Quality</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item">
                                <a href="../05_airflow_orchestration/" class="nav-link">Airflow Orchestration</a>
                            </li>
                            <li class="nav-item">
                                <a href="../06_powerbi_integration/" class="nav-link">Power BI Integration</a>
                            </li>
                            <li class="nav-item">
                                <a href="../07_development_guide/" class="nav-link">Development Guide</a>
                            </li>
                            <li class="nav-item">
                                <a href="./" class="nav-link active" aria-current="page">Troubleshooting</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../07_development_guide/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" class="nav-link disabled">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/M-Polonczyk/crypto-bi/edit/main/docs/08_troubleshooting.md" class="nav-link">Edit on crypto-bi
                                    </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#troubleshooting-guide" class="nav-link">Troubleshooting Guide</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#docker-compose-issues" class="nav-link">Docker Compose Issues</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#apache-airflow-issues" class="nav-link">Apache Airflow Issues</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#dbt-issues" class="nav-link">dbt Issues</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#postgresql-issues" class="nav-link">PostgreSQL Issues</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#general-debugging-steps" class="nav-link">General Debugging Steps</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="troubleshooting-guide">Troubleshooting Guide<a class="headerlink" href="#troubleshooting-guide" title="Permanent link">&para;</a></h1>
<p>This guide provides solutions and debugging tips for common issues encountered while working with the Crypto Analytics BI project.</p>
<h2 id="docker-compose-issues">Docker Compose Issues<a class="headerlink" href="#docker-compose-issues" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p><strong>Services Fail to Start / <code>docker-compose up</code> Errors:</strong></p>
<ul>
<li><strong>Check Docker Desktop/Engine:</strong> Ensure Docker is running and has sufficient resources (CPU, memory, disk space) allocated.</li>
<li><strong>Port Conflicts:</strong> If a port defined in <code>docker-compose.yaml</code> (e.g., <code>8080</code> for Airflow, <code>5432</code> for PostgreSQL) is already in use on your host machine, the service will fail to start.<ul>
<li><strong>Solution:</strong> Stop the conflicting service on your host or change the host-side port mapping in <code>docker-compose.yaml</code> (e.g., <code>ports: - "8081:8080"</code>).</li>
</ul>
</li>
<li><strong>Volume Mount Issues:</strong><ul>
<li>Ensure the local directories you are mounting as volumes (e.g., <code>./dags</code>, <code>./dbt_project</code>) exist and have correct permissions.</li>
<li>On Windows, file path issues with Docker Desktop can sometimes occur. Ensure paths are correctly specified.</li>
</ul>
</li>
<li><strong>Insufficient Disk Space:</strong> Docker images, volumes, and logs can consume significant disk space. Clean up unused Docker resources: <code>docker system prune -a --volumes</code>.</li>
<li><strong><code>.env</code> File Missing or Incorrect:</strong> Ensure the <code>.env</code> file exists in the project root and contains all necessary variables with correct values.</li>
<li><strong>Inspect Logs:</strong> Use <code>docker-compose logs &lt;service_name&gt;</code> (e.g., <code>docker-compose logs airflow-scheduler</code>) to see detailed error messages from a specific service.</li>
</ul>
</li>
<li>
<p><strong>Permission Denied Errors for Mounted Volumes (Especially for Airflow Logs/DAGs):</strong></p>
<ul>
<li>This often happens because the user inside the Docker container (e.g., <code>airflow</code> user with UID 50000) doesn't have write permissions to the directory mounted from the host.</li>
<li><strong>Solution 1 (Recommended in <code>docker-compose.yaml</code>):</strong> Set the <code>user: "${AIRFLOW_UID:-50000}:0"</code> (or your host user's UID/GID) for Airflow services in <code>docker-compose.yaml</code>. You might need to create an <code>AIRFLOW_UID</code> variable in your <code>.env</code> file with your host user's UID (<code>id -u</code> on Linux/macOS).</li>
<li><strong>Solution 2 (Host-side):</strong> Change permissions on the host directories (e.g., <code>chmod -R 777 ./logs ./dags</code>), but this is less secure.</li>
</ul>
</li>
</ol>
<h2 id="apache-airflow-issues">Apache Airflow Issues<a class="headerlink" href="#apache-airflow-issues" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p><strong>DAGs Not Appearing in UI / Not Scheduling:</strong></p>
<ul>
<li><strong>Syntax Errors in DAG File:</strong> Check Airflow scheduler logs (<code>docker-compose logs airflow-scheduler</code>) for Python import errors or syntax errors in your DAG file. The UI might also show a "Broken DAG" error.</li>
<li><strong><code>dags_folder</code> Configuration:</strong> Ensure the <code>dags_folder</code> in <code>airflow.cfg</code> (or the volume mount in <code>docker-compose.yaml</code>) correctly points to your <code>dags/</code> directory.</li>
<li><strong>Scheduler Not Running:</strong> Verify the <code>airflow-scheduler</code> container is running (<code>docker ps</code>).</li>
<li><strong><code>start_date</code> in the Future:</strong> If a DAG's <code>start_date</code> is in the future, it won't be scheduled until that date is reached (unless <code>catchup=True</code> and the schedule has passed).</li>
<li><strong><code>schedule_interval</code> is <code>None</code> or <code>@once</code>:</strong> Such DAGs only run when manually triggered (or once if <code>catchup=True</code> for a past <code>start_date</code>).</li>
</ul>
</li>
<li>
<p><strong>Tasks Failing:</strong></p>
<ul>
<li><strong>Inspect Task Logs:</strong> The most crucial step. In the Airflow UI, go to the DAG run, click on the failed task instance, and then "Log". This will show <code>stdout</code> and <code>stderr</code> from the task's execution.</li>
<li><strong>PYTHONPATH Issues:</strong> If <code>PythonOperator</code> tasks fail with <code>ModuleNotFoundError</code>, ensure the <code>src/</code> directory (or other custom module locations) is correctly added to <code>PYTHONPATH</code> for the Airflow workers/scheduler. This is often handled by mounting <code>src/</code> and adding to <code>sys.path</code> in the DAG file or via Dockerfile.</li>
<li><strong>Environment Variables Missing:</strong> If scripts rely on environment variables (e.g., API keys, database credentials), ensure they are correctly passed to the Airflow execution environment (via <code>.env</code> and <code>docker-compose.yaml</code>).</li>
<li><strong>Database Connection Errors (from Python scripts):</strong> Verify credentials, host (<code>postgres_app_db</code>), port (<code>5432</code>), and database name. Ensure the <code>postgres_app_db</code> service is healthy.</li>
<li><strong>Rate Limits:</strong> If ingesting from APIs, tasks might fail due to hitting rate limits. Implement delays or more robust retry mechanisms.</li>
</ul>
</li>
<li>
<p><strong>Airflow Webserver/Scheduler Fails to Connect to Metadata Database (<code>postgres_airflow_meta</code>):</strong></p>
<ul>
<li>Check logs of <code>airflow-webserver</code> and <code>airflow-scheduler</code>.</li>
<li>Verify the <code>SQL_ALCHEMY_CONN</code> string in the Airflow environment configuration (set in <code>docker-compose.yaml</code>) is correct and that <code>postgres_airflow_meta</code> service is healthy and its credentials match.</li>
</ul>
</li>
</ol>
<h2 id="dbt-issues">dbt Issues<a class="headerlink" href="#dbt-issues" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p><strong><code>dbt run</code> or <code>dbt test</code> Fails (when run by Airflow or manually):</strong></p>
<ul>
<li><strong>Connection Errors (Profile Issues):</strong><ul>
<li>Ensure <code>profiles.yml</code> is correctly configured to connect to <code>postgres_app_db</code> (host should be the service name <code>postgres_app_db</code> when running inside Docker, or <code>localhost</code> if running dbt locally and connecting to the exposed Docker port).</li>
<li>Verify database credentials (<code>DB_USER_DBT</code>, <code>DB_PASSWORD_DBT</code>, <code>DB_NAME</code> etc.) are correct and available as environment variables if <code>profiles.yml</code> uses <code>env_var()</code>.</li>
<li>Test the connection using <code>dbt debug --project-dir ... --profiles-dir ...</code>.</li>
</ul>
</li>
<li><strong>SQL Errors in Models:</strong> The dbt output will usually show the failing SQL model and the database error message. Copy the compiled SQL (from <code>target/compiled/</code>) and run it directly against PostgreSQL using a SQL client for easier debugging.</li>
<li><strong>Model Not Found (<code>{{ ref('model_name') }}</code> or <code>{{ source(...) }}</code> errors):</strong><ul>
<li>Check for typos in model names or source definitions.</li>
<li>Ensure the referenced model/source exists and dbt can find it (check paths in <code>dbt_project.yml</code>).</li>
<li>Run <code>dbt compile</code> to see if dbt can resolve references.</li>
</ul>
</li>
<li><strong>Permission Issues in Database:</strong> The dbt database user (<code>DB_USER_DBT</code>) must have appropriate permissions (SELECT on source tables/schemas, CREATE/INSERT/SELECT/DROP on target schemas like <code>staging</code>, <code>analytics</code>).</li>
<li><strong>Test Failures (<code>dbt test</code>):</strong> dbt output will indicate which tests failed and often provide sample failing rows. Investigate the data in the relevant tables to understand why the assertion failed.</li>
</ul>
</li>
<li>
<p><strong><code>dbt deps</code> Fails:</strong></p>
<ul>
<li>Check <code>packages.yml</code> for correct package names and versions.</li>
<li>Ensure you have internet connectivity if fetching packages from dbt Hub.</li>
</ul>
</li>
</ol>
<h2 id="postgresql-issues">PostgreSQL Issues<a class="headerlink" href="#postgresql-issues" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p><strong>Cannot Connect to Database (from host SQL client or Power BI):</strong></p>
<ul>
<li>Ensure the <code>postgres_app_db</code> container is running (<code>docker ps</code>).</li>
<li>Verify the port mapping in <code>docker-compose.yaml</code> (e.g., <code>5432:5432</code>). You should connect to <code>localhost:5432</code> from your host.</li>
<li>Check credentials (<code>DB_USER_APP</code>, <code>DB_PASSWORD_APP</code>, <code>DB_NAME_APP</code> from <code>.env</code>).</li>
<li>Check PostgreSQL logs within the container: <code>docker logs &lt;postgres_app_db_container_name&gt;</code>.</li>
</ul>
</li>
<li>
<p><strong>Permission Denied in PostgreSQL:</strong></p>
<ul>
<li>The user connecting to the database (e.g., <code>DB_USER_APP</code> for Power BI, <code>DB_USER_DBT</code> for dbt) needs appropriate privileges on the schemas and tables they need to access.</li>
<li>You might need to <code>GRANT USAGE ON SCHEMA &lt;schema_name&gt; TO &lt;user_name&gt;;</code> and <code>GRANT SELECT ON ALL TABLES IN SCHEMA &lt;schema_name&gt; TO &lt;user_name&gt;;</code> etc.</li>
</ul>
</li>
</ol>
<h2 id="general-debugging-steps">General Debugging Steps<a class="headerlink" href="#general-debugging-steps" title="Permanent link">&para;</a></h2>
<ol>
<li><strong>Isolate the Problem:</strong> Try to determine which component is failing (Docker, Airflow, dbt, PostgreSQL, Python script).</li>
<li><strong>Check Logs:</strong> This is almost always the first and most important step.<ul>
<li><code>docker-compose logs &lt;service_name&gt;</code></li>
<li>Airflow Task Logs (via UI)</li>
<li>dbt command line output (and <code>logs/dbt.log</code> in your <code>dbt_project</code> or the <code>target</code> directory if configured)</li>
</ul>
</li>
<li><strong>Simplify:</strong> If a complex DAG or dbt model fails, try running a simpler version or individual parts to pinpoint the error.</li>
<li><strong>Consult Documentation:</strong> Refer to the official documentation for Airflow, dbt, PostgreSQL, and the APIs you are using.</li>
<li><strong>Google the Error Message:</strong> Often, someone else has encountered a similar issue.</li>
</ol>
<p>Remember to be specific when asking for help (e.g., on Stack Overflow or team channels), providing:
* The exact error message.
* Relevant code snippets.
* Steps to reproduce the issue.
* Your environment details (OS, Docker version, tool versions).</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
