<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://M-Polonczyk.github.io/crypto-bi/04_dbt_data_modeling/04_02_sources/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Sources - Crypto BI</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../css/brands.min.css" rel="stylesheet">
        <link href="../../css/solid.min.css" rel="stylesheet">
        <link href="../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">Crypto BI</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../01_architecture/" class="nav-link">System Architecture</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../02_data_sources/" class="nav-link">Data Sources</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../03_ingestion_pipeline/" class="nav-link">Ingestion Pipeline</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">dbt Data Modeling</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../.." class="dropdown-item">Home</a>
</li>
                                    
<li>
    <a href="../04_01_dimensional_model/" class="dropdown-item">Dimensional Model</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active" aria-current="page">Sources</a>
</li>
                                    
<li>
    <a href="../04_03_staging_layer.md" class="dropdown-item">Staging Layer</a>
</li>
                                    
<li>
    <a href="../04_04_marts_layer/" class="dropdown-item">Marts Layer</a>
</li>
                                    
<li>
    <a href="../04_05_testing_and_quality.md" class="dropdown-item">Testing and Quality</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item">
                                <a href="../../05_airflow_orchestration/" class="nav-link">Airflow Orchestration</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../06_powerbi_integration/" class="nav-link">Power BI Integration</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../07_development_guide/" class="nav-link">Development Guide</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../08_troubleshooting/" class="nav-link">Troubleshooting</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../04_01_dimensional_model/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../04_04_marts_layer/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/M-Polonczyk/crypto-bi/edit/main/docs/04_dbt_data_modeling/04_02_sources.md" class="nav-link">Edit on crypto-bi
                                    </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#dbt-sources" class="nav-link">dbt Sources</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#purpose-of-defining-sources" class="nav-link">Purpose of Defining Sources</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#implementation" class="nav-link">Implementation</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#key-configuration-options-in-sourcesyml" class="nav-link">Key Configuration Options in sources.yml</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#referencing-sources-in-models" class="nav-link">Referencing Sources in Models</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#example-staging-model" class="nav-link">Example Staging Model</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#benefits-of-a-staging-layer" class="nav-link">Benefits of a Staging Layer</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="dbt-sources">dbt Sources<a class="headerlink" href="#dbt-sources" title="Permanent link">&para;</a></h1>
<p>In dbt, <strong>sources</strong> are a way to declare and document the raw data tables that your dbt project ingests from external systems. They are the starting point for your dbt transformations. In our project, these are the tables in PostgreSQL populated by the Python ingestion scripts.</p>
<h2 id="purpose-of-defining-sources">Purpose of Defining Sources<a class="headerlink" href="#purpose-of-defining-sources" title="Permanent link">&para;</a></h2>
<ol>
<li><strong>Documentation:</strong> Clearly document where your raw data comes from, its schema, and expected columns.</li>
<li><strong>Data Lineage:</strong> <code>dbt docs generate</code> uses source definitions to build a lineage graph, showing how raw data flows into your final models.</li>
<li><strong>Testing at Source:</strong> You can apply basic tests directly to source tables, such as:<ul>
<li><strong>Freshness checks:</strong> Ensure the data isn't stale.</li>
<li><strong>Row count checks:</strong> Monitor if data loading is happening as expected.</li>
<li>Basic column-level tests (<code>not_null</code>, <code>unique</code> on expected keys).</li>
</ul>
</li>
<li><strong>Abstraction:</strong> Staging models can then reference these sources using the <code>{{ source('source_name', 'table_name') }}</code> macro, making it easy to change the underlying raw table name or schema in one place (<code>sources.yml</code>) if needed.</li>
</ol>
<h2 id="implementation">Implementation<a class="headerlink" href="#implementation" title="Permanent link">&para;</a></h2>
<p>Source definitions are typically located in <code>.yml</code> files within your <code>dbt_project/models/</code> directory, often grouped logically (e.g., <code>models/staging/schema.yml</code>, or a dedicated <code>models/sources.yml</code>).</p>
<p><strong>File Example:</strong> <code>dbt_project/models/sources.yml</code> (or could be <code>models/staging/sources.yml</code>)</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="nt">sources</span><span class="p">:</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">raw_blockchair</span><span class="w"> </span><span class="c1"># A logical grouping for Blockchair data</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Raw</span><span class="nv"> </span><span class="s">data</span><span class="nv"> </span><span class="s">ingested</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">Blockchair</span><span class="nv"> </span><span class="s">API</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">various</span><span class="nv"> </span><span class="s">cryptocurrencies.&quot;</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">    </span><span class="c1"># You can specify the database and schema if it&#39;s different from your target profile&#39;s default</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">    </span><span class="c1"># database: your_raw_database </span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">    </span><span class="nt">schema</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">public</span><span class="w"> </span><span class="c1"># The schema where ingestion scripts load Blockchair data (e.g., &#39;public&#39; or &#39;raw_data&#39;)</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="w">    </span><span class="c1"># loader: &quot;Airflow Ingestion DAGs&quot; # Optional metadata</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="w">    </span><span class="c1"># loaded_at_field: &quot;etl_loaded_at_timestamp&quot; # If you have a load timestamp in raw tables for freshness</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="w">    </span><span class="nt">tables</span><span class="p">:</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">raw_blockchain_blocks</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Raw</span><span class="nv"> </span><span class="s">blocks</span><span class="nv"> </span><span class="s">data</span><span class="nv"> </span><span class="s">ingested</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">Blockchair</span><span class="nv"> </span><span class="s">API</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">BTC,</span><span class="nv"> </span><span class="s">ETH,</span><span class="nv"> </span><span class="s">DOGE.&quot;</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="w">        </span><span class="c1"># freshness: # Example freshness check (requires loaded_at_field)</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="w">        </span><span class="c1">#   warn_after: {count: 24, period: hour}</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="w">        </span><span class="c1">#   error_after: {count: 48, period: hour}</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="w">        </span><span class="nt">columns</span><span class="p">:</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">block_id</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="w">            </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;The</span><span class="nv"> </span><span class="s">unique</span><span class="nv"> </span><span class="s">ID</span><span class="nv"> </span><span class="s">(height)</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">block.&quot;</span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="w">            </span><span class="nt">tests</span><span class="p">:</span>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">not_null</span>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="w">              </span><span class="c1"># - unique # Block ID is unique per coin, so a composite unique test might be better</span>
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">coin_symbol</span>
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a><span class="w">            </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Symbol</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">cryptocurrency</span><span class="nv"> </span><span class="s">(BTC,</span><span class="nv"> </span><span class="s">ETH,</span><span class="nv"> </span><span class="s">DOGE).&quot;</span>
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a><span class="w">            </span><span class="nt">tests</span><span class="p">:</span>
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a><span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">not_null</span>
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">block_hash</span>
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a><span class="w">            </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;The</span><span class="nv"> </span><span class="s">unique</span><span class="nv"> </span><span class="s">hash</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">block.&quot;</span>
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a><span class="w">            </span><span class="nt">tests</span><span class="p">:</span>
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a><span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unique</span><span class="w"> </span><span class="c1"># Block hash should be globally unique</span>
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a><span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">not_null</span>
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">block_time</span>
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a><span class="w">            </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Timestamp</span><span class="nv"> </span><span class="s">when</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">block</span><span class="nv"> </span><span class="s">was</span><span class="nv"> </span><span class="s">mined.&quot;</span>
<a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a><span class="w">          </span><span class="c1"># Add all other relevant columns from your raw_blockchain_blocks table</span>
<a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a>
<a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">raw_blockchain_transactions</span>
<a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Raw</span><span class="nv"> </span><span class="s">transactions</span><span class="nv"> </span><span class="s">data</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">Blockchair</span><span class="nv"> </span><span class="s">API.&quot;</span>
<a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a><span class="w">        </span><span class="nt">columns</span><span class="p">:</span>
<a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tx_hash</span>
<a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a><span class="w">            </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;The</span><span class="nv"> </span><span class="s">unique</span><span class="nv"> </span><span class="s">hash</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">transaction.&quot;</span>
<a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a><span class="w">            </span><span class="nt">tests</span><span class="p">:</span>
<a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a><span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unique</span><span class="w"> </span><span class="c1"># Transaction hash should be globally unique</span>
<a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a><span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">not_null</span>
<a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">coin_symbol</span>
<a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a><span class="w">            </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Symbol</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">cryptocurrency.&quot;</span>
<a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a><span class="w">            </span><span class="nt">tests</span><span class="p">:</span>
<a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a><span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">not_null</span>
<a id="__codelineno-0-49" name="__codelineno-0-49" href="#__codelineno-0-49"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">block_id</span>
<a id="__codelineno-0-50" name="__codelineno-0-50" href="#__codelineno-0-50"></a><span class="w">            </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ID</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">block</span><span class="nv"> </span><span class="s">containing</span><span class="nv"> </span><span class="s">this</span><span class="nv"> </span><span class="s">transaction.&quot;</span>
<a id="__codelineno-0-51" name="__codelineno-0-51" href="#__codelineno-0-51"></a><span class="w">          </span><span class="c1"># Add all other relevant columns</span>
<a id="__codelineno-0-52" name="__codelineno-0-52" href="#__codelineno-0-52"></a>
<a id="__codelineno-0-53" name="__codelineno-0-53" href="#__codelineno-0-53"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">raw_coingecko</span><span class="w"> </span><span class="c1"># A logical grouping for CoinGecko data</span>
<a id="__codelineno-0-54" name="__codelineno-0-54" href="#__codelineno-0-54"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Raw</span><span class="nv"> </span><span class="s">market</span><span class="nv"> </span><span class="s">data</span><span class="nv"> </span><span class="s">ingested</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">CoinGecko</span><span class="nv"> </span><span class="s">API.&quot;</span>
<a id="__codelineno-0-55" name="__codelineno-0-55" href="#__codelineno-0-55"></a><span class="w">    </span><span class="nt">schema</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">public</span><span class="w"> </span><span class="c1"># The schema where ingestion scripts load CoinGecko data</span>
<a id="__codelineno-0-56" name="__codelineno-0-56" href="#__codelineno-0-56"></a><span class="w">    </span><span class="nt">tables</span><span class="p">:</span>
<a id="__codelineno-0-57" name="__codelineno-0-57" href="#__codelineno-0-57"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">raw_market_prices_volumes</span>
<a id="__codelineno-0-58" name="__codelineno-0-58" href="#__codelineno-0-58"></a><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Raw</span><span class="nv"> </span><span class="s">daily</span><span class="nv"> </span><span class="s">prices,</span><span class="nv"> </span><span class="s">volumes,</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">market</span><span class="nv"> </span><span class="s">caps</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">CoinGecko</span><span class="nv"> </span><span class="s">API.&quot;</span>
<a id="__codelineno-0-59" name="__codelineno-0-59" href="#__codelineno-0-59"></a><span class="w">        </span><span class="c1"># loaded_at_field: &quot;updated_at&quot; # If CoinGecko provides an update timestamp</span>
<a id="__codelineno-0-60" name="__codelineno-0-60" href="#__codelineno-0-60"></a><span class="w">        </span><span class="c1"># freshness:</span>
<a id="__codelineno-0-61" name="__codelineno-0-61" href="#__codelineno-0-61"></a><span class="w">        </span><span class="c1">#   warn_after: {count: 2, period: day} # Expect daily updates</span>
<a id="__codelineno-0-62" name="__codelineno-0-62" href="#__codelineno-0-62"></a><span class="w">        </span><span class="nt">columns</span><span class="p">:</span>
<a id="__codelineno-0-63" name="__codelineno-0-63" href="#__codelineno-0-63"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">coin_id</span>
<a id="__codelineno-0-64" name="__codelineno-0-64" href="#__codelineno-0-64"></a><span class="w">            </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;CoinGecko&#39;s</span><span class="nv"> </span><span class="s">unique</span><span class="nv"> </span><span class="s">identifier</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">cryptocurrency.&quot;</span>
<a id="__codelineno-0-65" name="__codelineno-0-65" href="#__codelineno-0-65"></a><span class="w">            </span><span class="nt">tests</span><span class="p">:</span>
<a id="__codelineno-0-66" name="__codelineno-0-66" href="#__codelineno-0-66"></a><span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">not_null</span>
<a id="__codelineno-0-67" name="__codelineno-0-67" href="#__codelineno-0-67"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">price_date</span>
<a id="__codelineno-0-68" name="__codelineno-0-68" href="#__codelineno-0-68"></a><span class="w">            </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;The</span><span class="nv"> </span><span class="s">date</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">which</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">market</span><span class="nv"> </span><span class="s">data</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">recorded.&quot;</span>
<a id="__codelineno-0-69" name="__codelineno-0-69" href="#__codelineno-0-69"></a><span class="w">            </span><span class="nt">tests</span><span class="p">:</span>
<a id="__codelineno-0-70" name="__codelineno-0-70" href="#__codelineno-0-70"></a><span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">not_null</span>
<a id="__codelineno-0-71" name="__codelineno-0-71" href="#__codelineno-0-71"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">price_usd</span>
<a id="__codelineno-0-72" name="__codelineno-0-72" href="#__codelineno-0-72"></a><span class="w">            </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Price</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">USD.&quot;</span>
<a id="__codelineno-0-73" name="__codelineno-0-73" href="#__codelineno-0-73"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">volume_usd</span>
<a id="__codelineno-0-74" name="__codelineno-0-74" href="#__codelineno-0-74"></a><span class="w">            </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Trading</span><span class="nv"> </span><span class="s">volume</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">USD.&quot;</span>
<a id="__codelineno-0-75" name="__codelineno-0-75" href="#__codelineno-0-75"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">market_cap_usd</span>
<a id="__codelineno-0-76" name="__codelineno-0-76" href="#__codelineno-0-76"></a><span class="w">            </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Market</span><span class="nv"> </span><span class="s">capitalization</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">USD.&quot;</span>
<a id="__codelineno-0-77" name="__codelineno-0-77" href="#__codelineno-0-77"></a><span class="w">          </span><span class="c1"># Add composite unique test for coin_id and price_date</span>
<a id="__codelineno-0-78" name="__codelineno-0-78" href="#__codelineno-0-78"></a><span class="w">        </span><span class="nt">tests</span><span class="p">:</span>
<a id="__codelineno-0-79" name="__codelineno-0-79" href="#__codelineno-0-79"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">unique</span><span class="p">:</span>
<a id="__codelineno-0-80" name="__codelineno-0-80" href="#__codelineno-0-80"></a><span class="w">              </span><span class="nt">column_names</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">coin_id</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">price_date</span><span class="p p-Indicator">]</span>
</code></pre></div>
<h2 id="key-configuration-options-in-sourcesyml">Key Configuration Options in <code>sources.yml</code><a class="headerlink" href="#key-configuration-options-in-sourcesyml" title="Permanent link">&para;</a></h2>
<ul>
<li><strong><code>name</code> (for source block):</strong> A unique name for the source system (e.g., <code>raw_blockchair</code>).</li>
<li><strong><code>schema</code>:</strong> The schema in your database where these raw tables reside.</li>
<li><strong><code>database</code> (Optional):</strong> If the source tables are in a different database than your dbt target database.</li>
<li><strong><code>tables</code>:</strong> A list of tables belonging to this source.</li>
<li><strong><code>name</code> (for table block):</strong> The actual name of the table in your database.</li>
<li><strong><code>description</code>:</strong> Human-readable description of the table.</li>
<li><strong><code>columns</code>:</strong> A list of columns in the table.<ul>
<li><strong><code>name</code> (for column block):</strong> The actual column name.</li>
<li><strong><code>description</code>:</strong> Human-readable description of the column.</li>
<li><strong><code>tests</code>:</strong> A list of schema tests to apply to this column (e.g., <code>unique</code>, <code>not_null</code>, <code>accepted_values</code>, <code>relationships</code>).</li>
</ul>
</li>
<li><strong><code>tests</code> (at table level):</strong> A list of tests that apply to the whole table (e.g., a multi-column unique test).</li>
<li><strong><code>freshness</code> (Optional):</strong> Defines acceptable data latency. Requires a timestamp column in the source table (<code>loaded_at_field</code>) indicating when the data was last updated.</li>
<li><strong><code>loaded_at_field</code> (Optional):</strong> Specifies the column used for freshness checks.</li>
</ul>
<h2 id="referencing-sources-in-models">Referencing Sources in Models<a class="headerlink" href="#referencing-sources-in-models" title="Permanent link">&para;</a></h2>
<p>In your staging models (e.g., <code>models/staging/stg_blockchair__blocks.sql</code>), you will refer to these source tables using the <code>source()</code> macro:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="k">FROM</span><span class="w"> </span><span class="err">{{</span><span class="w"> </span><span class="k">source</span><span class="p">(</span><span class="s1">&#39;raw_blockchair&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;raw_blockchain_blocks&#39;</span><span class="p">)</span><span class="w"> </span><span class="err">}}</span>
</code></pre></div>
<p>This decouples your staging logic from the exact physical location of the raw data, making your dbt project more maintainable.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>---
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>**`docs/04_dbt_data_modeling/04_03_staging_layer.md`**
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>```markdown
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a># dbt Staging Layer
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>The **staging layer** is the first transformation layer in our dbt project. Its primary purpose is to take the raw data ingested from external sources (as defined in `sources.yml`) and prepare it for more complex transformations and modeling in downstream layers (intermediate and marts).
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>## Goals of the Staging Layer
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>1.  **One-to-One Mapping (Generally):** Typically, there is one staging model for each source table.
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>2.  **Light Transformations:** Only basic, necessary transformations are performed here. Avoid complex business logic or joins between different source concepts in this layer.
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>3.  **Data Cleansing:**
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>    *   **Renaming Columns:** Rename columns to consistent, clear, and business-friendly names (e.g., `tx_time` to `transaction_timestamp_utc`).
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>    *   **Type Casting:** Convert columns to their correct data types (e.g., string representations of dates to `DATE` or `TIMESTAMP`, string numbers to `NUMERIC` or `INTEGER`).
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>    *   **Basic Formatting:** Apply minimal formatting if necessary (e.g., trimming whitespace, standardizing case for certain string fields â€“ though this can also be done later).
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>4.  **Deriving Basic Attributes:** Create simple derived columns if universally useful (e.g., extracting the date part from a timestamp: `DATE(transaction_timestamp_utc) AS transaction_date`).
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>5.  **Filtering (Minimal):** Remove records that are unequivocally irrelevant for any downstream analysis (e.g., test records from a source system, completely malformed rows if not handled during ingestion). However, be cautious with filtering at this stage; it&#39;s often better to filter in downstream models where the business context is clearer.
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>6.  **No Joins Between Different Source Entities:** Staging models should focus on a single source table. Joins to bring together different concepts (e.g., transactions with block details from a separate blocks table, if they were separate sources) happen in intermediate or mart layers.
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a>
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a>## Implementation in dbt
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a>
<a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a>-   Staging models are SQL files located in the `dbt_project/models/staging/` directory.
<a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a>-   They typically use Common Table Expressions (CTEs) for readability, often starting with a CTE that selects from a `{{ source(...) }}`.
<a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a>-   **Naming Convention:** `stg_&lt;source_name&gt;__&lt;object_name&gt;.sql` (e.g., `stg_blockchair__blocks.sql`, `stg_coingecko__prices_volumes.sql`). The double underscore `__` is a common convention to separate the source system from the object.
<a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a>
<a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a>## Materialization
<a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a>
<a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a>-   Staging models are often materialized as **`views`** in the database.
<a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a>    -   **Pros:** No additional storage used (queries are executed against underlying raw tables on-the-fly), always reflect the latest raw data, faster dbt runs during development as no data is physically moved.
<a id="__codelineno-2-32" name="__codelineno-2-32" href="#__codelineno-2-32"></a>    -   **Cons:** Can be slower to query if the underlying raw tables are very large or if the view definition involves many calculations.
<a id="__codelineno-2-33" name="__codelineno-2-33" href="#__codelineno-2-33"></a>-   Alternatively, they can be materialized as **`tables`** if:
<a id="__codelineno-2-34" name="__codelineno-2-34" href="#__codelineno-2-34"></a>    -   Downstream models frequently query them, and performance is critical.
<a id="__codelineno-2-35" name="__codelineno-2-35" href="#__codelineno-2-35"></a>    *   You want to &quot;snapshot&quot; a version of the cleaned data.
<a id="__codelineno-2-36" name="__codelineno-2-36" href="#__codelineno-2-36"></a>-   The default materialization for the staging layer can be set in `dbt_project.yml`.
<a id="__codelineno-2-37" name="__codelineno-2-37" href="#__codelineno-2-37"></a>
<a id="__codelineno-2-38" name="__codelineno-2-38" href="#__codelineno-2-38"></a>**Example `dbt_project.yml` configuration for staging:**
<a id="__codelineno-2-39" name="__codelineno-2-39" href="#__codelineno-2-39"></a>```yaml
<a id="__codelineno-2-40" name="__codelineno-2-40" href="#__codelineno-2-40"></a>models:
<a id="__codelineno-2-41" name="__codelineno-2-41" href="#__codelineno-2-41"></a>  crypto_analytics: # Your project name
<a id="__codelineno-2-42" name="__codelineno-2-42" href="#__codelineno-2-42"></a>    staging:
<a id="__codelineno-2-43" name="__codelineno-2-43" href="#__codelineno-2-43"></a>      +materialized: view # Default for all models in models/staging/
<a id="__codelineno-2-44" name="__codelineno-2-44" href="#__codelineno-2-44"></a>      +schema: staging    # Output schema in PostgreSQL
</code></pre></div>
<h2 id="example-staging-model">Example Staging Model<a class="headerlink" href="#example-staging-model" title="Permanent link">&para;</a></h2>
<p><strong>File:</strong> <code>dbt_project/models/staging/blockchain/stg_blockchair__transactions.sql</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1">-- This CTE selects from the raw source table defined in sources.yml</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="k">WITH</span><span class="w"> </span><span class="n">source_data</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="err">{{</span><span class="w"> </span><span class="k">source</span><span class="p">(</span><span class="s1">&#39;raw_blockchair&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;raw_blockchain_transactions&#39;</span><span class="p">)</span><span class="w"> </span><span class="err">}}</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="p">)</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="c1">-- This CTE performs the light transformations</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="k">SELECT</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="w">    </span><span class="c1">-- Identifiers &amp; Keys</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="w">    </span><span class="n">tx_hash</span><span class="p">,</span><span class="w">                                 </span><span class="c1">-- Already a good name</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="w">    </span><span class="n">coin_symbol</span><span class="p">,</span><span class="w">                             </span><span class="c1">-- Already a good name</span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="w">    </span><span class="n">block_id</span><span class="p">,</span><span class="w">                                </span><span class="c1">-- Already a good name</span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="w">    </span><span class="c1">-- Timestamps &amp; Dates (Casting and Renaming)</span>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="w">    </span><span class="n">tx_time</span><span class="p">::</span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">transaction_timestamp_utc</span><span class="p">,</span><span class="w"> </span><span class="c1">-- Casting to TIMESTAMP</span>
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="w">    </span><span class="nb">DATE</span><span class="p">(</span><span class="n">tx_time</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">transaction_date</span><span class="p">,</span><span class="w">               </span><span class="c1">-- Deriving date part</span>
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a>
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a><span class="w">    </span><span class="c1">-- Monetary Values (Casting to NUMERIC if they are strings in raw)</span>
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a><span class="w">    </span><span class="n">fee_usd</span><span class="p">::</span><span class="nb">NUMERIC</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">fee_usd</span><span class="p">,</span>
<a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a><span class="w">    </span><span class="n">output_total_usd</span><span class="p">::</span><span class="nb">NUMERIC</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">output_total_usd</span><span class="p">,</span>
<a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a>
<a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a><span class="w">    </span><span class="c1">-- Counts</span>
<a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a><span class="w">    </span><span class="n">input_count</span><span class="p">::</span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">input_count</span><span class="p">,</span>
<a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a><span class="w">    </span><span class="n">output_count</span><span class="p">::</span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">output_count</span><span class="p">,</span>
<a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a>
<a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a><span class="w">    </span><span class="c1">-- Other Attributes</span>
<a id="__codelineno-3-27" name="__codelineno-3-27" href="#__codelineno-3-27"></a><span class="w">    </span><span class="n">size_bytes</span><span class="p">::</span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">transaction_size_bytes</span><span class="p">,</span><span class="w">  </span><span class="c1">-- Renaming and casting</span>
<a id="__codelineno-3-28" name="__codelineno-3-28" href="#__codelineno-3-28"></a><span class="w">    </span><span class="n">is_coinbase</span><span class="p">::</span><span class="nb">BOOLEAN</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">is_coinbase_transaction</span><span class="w"> </span><span class="c1">-- Casting if it&#39;s not already boolean</span>
<a id="__codelineno-3-29" name="__codelineno-3-29" href="#__codelineno-3-29"></a>
<a id="__codelineno-3-30" name="__codelineno-3-30" href="#__codelineno-3-30"></a><span class="w">    </span><span class="c1">-- Columns to exclude (if any) can be omitted from the SELECT list</span>
<a id="__codelineno-3-31" name="__codelineno-3-31" href="#__codelineno-3-31"></a><span class="w">    </span><span class="c1">-- e.g., raw_api_response_column_we_dont_need</span>
<a id="__codelineno-3-32" name="__codelineno-3-32" href="#__codelineno-3-32"></a>
<a id="__codelineno-3-33" name="__codelineno-3-33" href="#__codelineno-3-33"></a><span class="k">FROM</span><span class="w"> </span><span class="n">source_data</span>
<a id="__codelineno-3-34" name="__codelineno-3-34" href="#__codelineno-3-34"></a><span class="c1">-- Add WHERE clause for incremental processing if this model becomes incremental</span>
<a id="__codelineno-3-35" name="__codelineno-3-35" href="#__codelineno-3-35"></a><span class="c1">-- e.g., WHERE tx_time &gt;= (SELECT MAX(transaction_timestamp_utc) FROM {{ this }}) -- For incremental tables</span>
</code></pre></div>
<h2 id="benefits-of-a-staging-layer">Benefits of a Staging Layer<a class="headerlink" href="#benefits-of-a-staging-layer" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>DRY (Don't Repeat Yourself):</strong> Common cleaning logic is centralized, so you don't have to repeat it in multiple downstream models.</li>
<li><strong>Clarity and Readability:</strong> Downstream models (<code>intermediate</code> and <code>marts</code>) can then build upon this cleaned and consistently named data, making their logic simpler.</li>
<li><strong>Debugging:</strong> Easier to trace data issues back to their source. If a problem exists in a mart table, you can check the staging layer, and then the raw source.</li>
<li><strong>Improved Lineage:</strong> Provides a clear step in the data lineage graph.</li>
<li><strong>Performance (Potentially):</strong> If staging models are materialized as tables, they can pre-compute some transformations, speeding up downstream queries.</li>
</ul>
<p>The staging layer is a foundational part of a robust dbt project, ensuring that all subsequent transformations start from a common, clean baseline.</p>
<p>```</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
